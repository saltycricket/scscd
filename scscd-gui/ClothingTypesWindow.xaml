<Window x:Class="scscd_gui.wpf.ClothingTypesWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Clothing Types" Width="1000" Height="650">
	<DockPanel>
        <Grid>
			<Grid.RowDefinitions>
				<RowDefinition Height="*"/>
			</Grid.RowDefinitions>
			
			<Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*" MinWidth="200"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="2*"/>
            </Grid.ColumnDefinitions>

            <GroupBox Header="Clothing Types" Margin="8" Grid.Column="0">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto"/>
						<RowDefinition Height="*"/>
					</Grid.RowDefinitions>
					
					<ToolBar ToolBarTray.IsLocked="True">
						<Button Content="Add Item Type" Command="{Binding AddItemTypeCommand}"/>
						<Button Content="Remove" Command="{Binding RemoveItemTypeCommand}" Margin="6,0,0,0"/>
						<Separator/>
						<Button Content="Save All" Command="{Binding SaveAllCommand}"/>
					</ToolBar>

					<DataGrid x:Name="ItemTypesGrid"
								Grid.Row="1"
								ItemsSource="{Binding ItemTypes}"
								SelectedItem="{Binding SelectedItemType, Mode=TwoWay}"
								AutoGenerateColumns="False"
								CanUserAddRows="False"
								CanUserDeleteRows="False"
								IsReadOnly="False"
								HeadersVisibility="Column"
								RowHeaderWidth="0"
								VerticalScrollBarVisibility="Auto"
								HorizontalScrollBarVisibility="Auto"
								Margin="0">

						<DataGrid.Columns>
							<!-- 1) Name: text, validates on data errors -->
							<DataGridTemplateColumn Header="Name" Width="170">
								<!-- Display -->
								<DataGridTemplateColumn.CellTemplate>
									<DataTemplate>
										<Border x:Name="bd" Padding="0">
											<TextBlock x:Name="tb"
														Text="{Binding Name, ValidatesOnNotifyDataErrors=True, ValidatesOnDataErrors=True}"/>
										</Border>
									</DataTemplate>
								</DataGridTemplateColumn.CellTemplate>

								<!-- Edit -->
								<DataGridTemplateColumn.CellEditingTemplate>
									<DataTemplate>
										<TextBox
											Text="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged,
												ValidatesOnNotifyDataErrors=True, ValidatesOnDataErrors=True}"/>
									</DataTemplate>
								</DataGridTemplateColumn.CellEditingTemplate>
							</DataGridTemplateColumn>

							<!-- 2) CSV File: template with ComboBox + Browse button -->
							<DataGridTemplateColumn Header="CSV File" Width="280">
								<!-- Display -->
								<DataGridTemplateColumn.CellTemplate>
									<DataTemplate>
										<Border x:Name="bd" Padding="0">
											<TextBlock x:Name="tb"
														Text="{Binding SourceCsv, ValidatesOnNotifyDataErrors=True, ValidatesOnDataErrors=True}"/>
										</Border>
									</DataTemplate>
								</DataGridTemplateColumn.CellTemplate>

								<!-- Edit -->
								<DataGridTemplateColumn.CellEditingTemplate>
									<DataTemplate>
										<DockPanel LastChildFill="True">
											<Button Content="..." DockPanel.Dock="Right" Margin="4,0,0,0" Padding="8,0"
													Command="{Binding DataContext.BrowseCsvCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
													CommandParameter="{Binding}" />
											<ComboBox
												ItemsSource="{Binding DataContext.CsvChoices, RelativeSource={RelativeSource AncestorType=DataGrid}}"
												IsEditable="True" IsTextSearchEnabled="True" StaysOpenOnEdit="True"
												Text="{Binding SourceCsv, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged,
                        ValidatesOnNotifyDataErrors=True, ValidatesOnDataErrors=True}"
												MinWidth="220"/>
										</DockPanel>
									</DataTemplate>
								</DataGridTemplateColumn.CellEditingTemplate>
							</DataGridTemplateColumn>
						</DataGrid.Columns>
					</DataGrid>
				</Grid>
            </GroupBox>

            <!-- Splitter -->
            <GridSplitter Grid.Column="1" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Background="LightGray"/>

			<Grid Grid.Column="2">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="3*"/>
					<ColumnDefinition Width="3*"/>
				</Grid.ColumnDefinitions>

				<!-- MIDDLE: ARMO -->
				<GroupBox Grid.Column="0">
					<GroupBox.Header>
						<StackPanel Orientation="Horizontal">
							<TextBlock Text="Equip Slots" FontWeight="Bold" VerticalAlignment="Center"/>
							<TextBlock Text=" ?" Foreground="SteelBlue" Margin="6,0,0,0"
                           ToolTipService.InitialShowDelay="0" ToolTipService.ShowDuration="60000">
								<TextBlock.ToolTip>
									<ToolTip MaxWidth="360" Padding="10">
										<TextBlock TextWrapping="Wrap">
											Select the slots that this item uses when equipped. Other items
											cannot be equipped if they share any of the same slots.
										</TextBlock>
									</ToolTip>
								</TextBlock.ToolTip>
							</TextBlock>
						</StackPanel>
					</GroupBox.Header>

					<ScrollViewer VerticalScrollBarVisibility="Auto">
						<ItemsControl ItemsSource="{Binding SelectedItemType.Slots}">
							<ItemsControl.ItemsPanel>
								<ItemsPanelTemplate>
									<StackPanel/>
								</ItemsPanelTemplate>
							</ItemsControl.ItemsPanel>
							<ItemsControl.ItemTemplate>
								<DataTemplate>
									<CheckBox Content="{Binding Name}"
                              IsChecked="{Binding IsArmoChecked, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                              Margin="4,2"/>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>
					</ScrollViewer>
				</GroupBox>

				<!-- RIGHT: ARMA -->
				<GroupBox Grid.Column="1">
					<GroupBox.Header>
						<StackPanel Orientation="Horizontal">
							<TextBlock Text="Invisible Slots" FontWeight="Bold" VerticalAlignment="Center"/>
							<TextBlock Text=" ?" Foreground="SteelBlue" Margin="6,0,0,0"
                           ToolTipService.InitialShowDelay="0" ToolTipService.ShowDuration="60000">
								<TextBlock.ToolTip>
									<ToolTip MaxWidth="360" Padding="10">
										<StackPanel>
											<TextBlock TextWrapping="Wrap">
												Select slots that can still be equipped, but will NOT be drawn
												if this item is worn. For example, select "Long Hair" to hide
												the hair under a helmet.
											</TextBlock>
										</StackPanel>
									</ToolTip>
								</TextBlock.ToolTip>
							</TextBlock>
						</StackPanel>
					</GroupBox.Header>

					<ScrollViewer VerticalScrollBarVisibility="Auto">
						<ItemsControl ItemsSource="{Binding SelectedItemType.Slots}">
							<ItemsControl.ItemsPanel>
								<ItemsPanelTemplate>
									<StackPanel/>
								</ItemsPanelTemplate>
							</ItemsControl.ItemsPanel>
							<ItemsControl.ItemTemplate>
								<DataTemplate>
									<CheckBox Content="{Binding Name}"
                              IsChecked="{Binding IsArmaChecked, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                              Margin="4,2"/>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>
					</ScrollViewer>
				</GroupBox>
			</Grid>
        </Grid>
    </DockPanel>
</Window>
